@model IReadOnlyList<DemoDayCQRSProject.CQRS.Results.ContactResult.ContactMessageResult>
@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var page = (int)(ViewBag.Page ?? 1);
    var pageSize = (int)(ViewBag.PageSize ?? 20);
    string search = ViewBag.Search as string ?? "";
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="mb-0">Müşteri Mesajları</h3>
    <form method="get" class="d-flex" style="gap:.5rem">
        <input type="text" class="form-control" name="search" value="@search" placeholder="arama için mail/isim giriniz" />
        <button class="btn btn-primary" type="submit">Ara</button>
    </form>
</div>

<div class="table-responsive">
    <table class="table table-hover align-middle">
        <thead class="table-light">
            <tr>
                <th>Tarih</th>
                <th>İsim</th>
                <th>Email</th>
                <th>Konu</th>
                <th>AI Cevabı</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @if (Model != null && Model.Count > 0)
            {
                foreach (var m in Model)
                {
                    <tr>
                        <td>@m.CreatedAt.ToLocalTime().ToString("yyyy-MM-dd HH:mm")</td>
                        <td>@m.Name</td>
                        <td>@m.Email</td>
                        <td>@m.Subject</td>
                        <td class="text-truncate" style="max-width: 260px;">
                            @(!string.IsNullOrEmpty(m.AiReplyPreview)
                                ? (m.AiReplyPreview.Length > 120 ? m.AiReplyPreview.Substring(0, 120) + "..." : m.AiReplyPreview)
                                : "-")
                        </td>
                        <td class="text-end">
                            <a class="btn btn-sm btn-outline-primary" href="@Url.Action("Details", new { id = m.Id })">
                                Detay
                            </a>
                        </td>
                    </tr>
                }
            }
            else
            {
                <tr><td colspan="6" class="text-center text-muted">No messages found.</td></tr>
            }
        </tbody>
    </table>
</div>

<!-- Basit sayfalama (gerçek toplam sayıyı biliyorsan ona göre geliştirebilirsin) -->
<div class="d-flex justify-content-between">
    <a class="btn btn-outline-secondary @(page <= 1 ? "disabled" : "")"
       href="@Url.Action("Index", new { page = page - 1, pageSize, search })">« Önceki</a>

    <a class="btn btn-outline-secondary"
       href="@Url.Action("Index", new { page = page + 1, pageSize, search })">Sonraki »</a>
</div>

